<queries>
  <query name="net.ksdr1.powerschool.oneroster.users" coreTable="users" flattened="true">
	<summary>OneRoster 1.1 users</summary>
    <columns>
      <column column="USERS.STATE">a_sourcedId</column>
	  <column column="SCHOOLSTAFF.STATUS">b_status</column>
	  <column column="USERS.HOMEROOM">c_dateLastModified</column>
	  <column column="SCHOOLSTAFF.STATUS">d_enabledUser</column>
	  <column column="USERS.HOMESCHOOLID">e_orgSourcedIds</column>
	  <column column="USERS.LOGINID">f_role</column>
	  <column column="USERS.TEACHERLOGINID">g_username</column>
	  <column column="USERS.ZIP">h_userIds</column>
	  <column column="USERS.FIRST_NAME">i_givenName</column>
	  <column column="USERS.LAST_NAME">j_familyName</column>
	  <column column="USERS.MIDDLE_NAME">k_middleName</column>
	  <column column="USERS.TEACHERNUMBER">l_identifier</column>
	  <column column="USERS.EMAIL_ADDR">m_email</column>
	  <column column="USERS.SCHOOL_PHONE">n_sms</column>
	  <column column="USERS.HOME_PHONE">o_phone</column>
	  <column column="USERS.CITY">p_agentSourceIds</column>
	  <column column="USERS.TITLE">q_grades</column>
	  <column column="USERS.STREET">r_password</column>
    </columns>
    <sql><![CDATA[
select 
  'T'||users.dcid as sourcedId,
  case schoolstaff.status 
    when 1 then 'active'
    else 'inactive'
  end as status,
  null as dateLastModified,
  case schoolstaff.status
    when 1 then 'true'
    else 'false'
  end as enabledUser,
  case cast(users.homeschoolid as varchar2(10))
    when '0' then cast((select prefs.value from prefs where prefs.name = 'districtnumber') as varchar2(10))
    else cast(users.homeschoolid as varchar2(10))
  end as orgSourcedIds,
  'teacher' as role,
  case 
    when users.teacherloginid is not null then users.teacherloginid
    else users.loginid
  end as username,
  null as userIds,
  users.first_name as givenName,
  users.last_name as familyName,
  substr(users.middle_name,0,1) as middleName,
  users.teachernumber as identifier,
  users.email_addr as email,
  null as sms,
  users.home_phone as phone,
  null as agentSourcedIds,
  null as grades,
  null as password
from users
left join schoolstaff on users.dcid = schoolstaff.users_dcid
left join schools on schools.school_number = users.homeschoolid
where users.homeschoolid = schoolstaff.schoolid
and schoolstaff.STATUS = 1
and schoolstaff.staffstatus = 1
and users.email_addr is not null
and (users.teacherloginid is not null or users.loginid is not null)
union all
select
  'S'||students.dcid as sourcedId,
  case students.enroll_status 
    when 0 then 'active'
    else 'inactive'
  end as status,
  null as dateLastModified,
  case students.enroll_status
    when 0 then 'true'
    else 'false'
  end as enabledUser,
  cast(students.schoolid as varchar2(10)) as orgSourcedIds,
  'student' as role,
  students.student_web_id as username,
  null as userIds,
  students.first_name as givenName,
  students.last_name as familyName,
  substr(students.middle_name,0,1) as middleName,
  to_char(students.student_number) as identifier,
  psm_studentcontact.email as email,
  null as sms,
  students.home_phone as phone,
  null as agentSourcedIds,
  case 
    when students.grade_level <= -3 then 'IT'
    when students.grade_level between -2 and -1 then 'PK'
    when students.grade_level = 0 then 'KG'
    when students.grade_level between 1 and 12 then to_char(students.grade_level,'00')
    when students.grade_level > 12 then 'PS'
    else 'Other'
  end as grades,
  null as password
from students
left join schools on students.schoolid = schools.school_number
left join sync_studentmap on students.dcid = sync_studentmap.studentsdcid
left join psm_studentcontact on psm_studentcontact.studentid = sync_studentmap.studentid
left join psm_studentcontacttype on psm_studentcontacttype.id = psm_studentcontact.studentcontacttypeid
where students.enroll_status = 0
and psm_studentcontacttype.name = 'Self'
    ]]></sql>
  </query>
  <!-- Define more queries here -->
</queries>